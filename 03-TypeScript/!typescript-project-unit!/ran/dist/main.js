"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.AcmeCyberSDK = void 0;
var _EventsManager = require("./managers/EventsManager");
var _ScreenWidthCollector = require("./collectors/regular/ScreenWidthCollector");
var _ScreenHeightCollector = require("./collectors/regular/ScreenHeightCollector");
var _LanguageCollector = require("./collectors/regular/LanguageCollector");
var _UserAgentCollector = require("./collectors/regular/UserAgentCollector");
var _TimezoneCollector = require("./collectors/regular/TimezoneCollector");
var _CookiesEnabledCollector = require("./collectors/regular/CookiesEnabledCollector");
var _JavaScriptEnabledCollector = require("./collectors/regular/JavaScriptEnabledCollector");
var _OnlineStatusCollector = require("./collectors/regular/OnlineStatusCollector");
var _ReferrerCollector = require("./collectors/regular/ReferrerCollector");
var _LocalStorageAvailableCollector = require("./collectors/regular/LocalStorageAvailableCollector");
var _BrowserInfoCollector = require("./collectors/regular/BrowserInfoCollector");
var _PlatformCollector = require("./collectors/regular/PlatformCollector");
var _HardwareConcurrencyCollector = require("./collectors/regular/HardwareConcurrencyCollector");
var _PluginsCollector = require("./collectors/regular/PluginsCollector");
var _DoNotTrackCollector = require("./collectors/regular/DoNotTrackCollector");
var _ColorDepthCollector = require("./collectors/regular/ColorDepthCollector");
var _TouchSupportCollector = require("./collectors/regular/TouchSupportCollector");
var _CurrentUrlCollector = require("./collectors/regular/CurrentUrlCollector");
var _HistoryLengthCollector = require("./collectors/regular/HistoryLengthCollector");
var _WindowSizeCollector = require("./collectors/regular/WindowSizeCollector");
var _ScreenOrientationCollector = require("./collectors/regular/ScreenOrientationCollector");
var _VideoSupportCollector = require("./collectors/regular/VideoSupportCollector");
var _MouseMoveCollector = require("./collectors/continuous/MouseMoveCollector");
var _KeyboardPressCollector = require("./collectors/continuous/KeyboardPressCollector");
var _ClicksCollector = require("./collectors/continuous/ClicksCollector");
var _ScrollCollector = require("./collectors/continuous/ScrollCollector");
var _ResizeCollector = require("./collectors/continuous/ResizeCollector");
var _VisibilityChangeCollector = require("./collectors/continuous/VisibilityChangeCollector");
class AcmeCyberSDK {
  collectors = [];
  constructor() {
    this.eventsManager = _EventsManager.EventsManager.getInstance();
  }
  async initializeCollectors() {
    const config = await this.eventsManager.getConfig();
    const regularCollectors = [_ScreenWidthCollector.ScreenWidthCollector, _ScreenHeightCollector.ScreenHeightCollector, _LanguageCollector.LanguageCollector, _UserAgentCollector.UserAgentCollector, _TimezoneCollector.TimezoneCollector, _CookiesEnabledCollector.CookiesEnabledCollector, _JavaScriptEnabledCollector.JavaScriptEnabledCollector, _OnlineStatusCollector.OnlineStatusCollector, _ReferrerCollector.ReferrerCollector, _LocalStorageAvailableCollector.LocalStorageAvailableCollector, _BrowserInfoCollector.BrowserInfoCollector, _PlatformCollector.PlatformCollector, _HardwareConcurrencyCollector.HardwareConcurrencyCollector, _PluginsCollector.PluginsCollector, _DoNotTrackCollector.DoNotTrackCollector, _ColorDepthCollector.ColorDepthCollector, _TouchSupportCollector.TouchSupportCollector, _CurrentUrlCollector.CurrentUrlCollector, _HistoryLengthCollector.HistoryLengthCollector, _WindowSizeCollector.WindowSizeCollector, _ScreenOrientationCollector.ScreenOrientationCollector, _VideoSupportCollector.VideoSupportCollector];
    const continuousCollectors = [_MouseMoveCollector.MouseMoveCollector, _KeyboardPressCollector.KeyboardPressCollector, _ClicksCollector.ClicksCollector, _ScrollCollector.ScrollCollector, _ResizeCollector.ResizeCollector, _VisibilityChangeCollector.VisibilityChangeCollector];
    this.collectors = [...regularCollectors.map(CollectorClass => {
      try {
        return new CollectorClass(config.COLLECTORS_INTERVAL);
      } catch (error) {
        console.error(`Failed to initialize ${CollectorClass.name}:`, error);
        return null;
      }
    }), ...continuousCollectors.map(CollectorClass => {
      try {
        return new CollectorClass(config.COLLECTORS_INTERVAL, config.DEFAULT_BUFFER_CONTINUOUS_COLLECTORS);
      } catch (error) {
        console.error(`Failed to initialize ${CollectorClass.name}:`, error);
        return null;
      }
    })].filter(collector => collector !== null);
  }
  async start() {
    const config = await this.eventsManager.getConfig();
    if (config.SDK_ENABLED) {
      await this.initializeCollectors();
      this.collectors.forEach(collector => {
        try {
          collector.startCollect();
        } catch (error) {
          console.error(`Failed to start ${collector.getKey()} collector:`, error);
        }
      });
      this.scheduleDataUpdate();
    }
  }
  async scheduleDataUpdate() {
    const config = await this.eventsManager.getConfig();
    setInterval(async () => {
      const data = {};
      for (const collector of this.collectors) {
        try {
          data[collector.getKey()] = collector.getData();
        } catch (error) {
          console.error(`Error collecting data from ${collector.getKey()}:`, error);
          data[collector.getKey()] = null;
        }
      }
      try {
        await this.eventsManager.updateData(data);
      } catch (error) {
        console.error('Failed to update data:', error);
      }
    }, config.COLLECTORS_INTERVAL);
  }
}
exports.AcmeCyberSDK = AcmeCyberSDK;
document.addEventListener('acme-sdk-loaded', async () => {
  const sdk = new AcmeCyberSDK();
  await sdk.start();
});
document.dispatchEvent(new CustomEvent('acme-sdk-loaded'));
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfRXZlbnRzTWFuYWdlciIsInJlcXVpcmUiLCJfU2NyZWVuV2lkdGhDb2xsZWN0b3IiLCJfU2NyZWVuSGVpZ2h0Q29sbGVjdG9yIiwiX0xhbmd1YWdlQ29sbGVjdG9yIiwiX1VzZXJBZ2VudENvbGxlY3RvciIsIl9UaW1lem9uZUNvbGxlY3RvciIsIl9Db29raWVzRW5hYmxlZENvbGxlY3RvciIsIl9KYXZhU2NyaXB0RW5hYmxlZENvbGxlY3RvciIsIl9PbmxpbmVTdGF0dXNDb2xsZWN0b3IiLCJfUmVmZXJyZXJDb2xsZWN0b3IiLCJfTG9jYWxTdG9yYWdlQXZhaWxhYmxlQ29sbGVjdG9yIiwiX0Jyb3dzZXJJbmZvQ29sbGVjdG9yIiwiX1BsYXRmb3JtQ29sbGVjdG9yIiwiX0hhcmR3YXJlQ29uY3VycmVuY3lDb2xsZWN0b3IiLCJfUGx1Z2luc0NvbGxlY3RvciIsIl9Eb05vdFRyYWNrQ29sbGVjdG9yIiwiX0NvbG9yRGVwdGhDb2xsZWN0b3IiLCJfVG91Y2hTdXBwb3J0Q29sbGVjdG9yIiwiX0N1cnJlbnRVcmxDb2xsZWN0b3IiLCJfSGlzdG9yeUxlbmd0aENvbGxlY3RvciIsIl9XaW5kb3dTaXplQ29sbGVjdG9yIiwiX1NjcmVlbk9yaWVudGF0aW9uQ29sbGVjdG9yIiwiX1ZpZGVvU3VwcG9ydENvbGxlY3RvciIsIl9Nb3VzZU1vdmVDb2xsZWN0b3IiLCJfS2V5Ym9hcmRQcmVzc0NvbGxlY3RvciIsIl9DbGlja3NDb2xsZWN0b3IiLCJfU2Nyb2xsQ29sbGVjdG9yIiwiX1Jlc2l6ZUNvbGxlY3RvciIsIl9WaXNpYmlsaXR5Q2hhbmdlQ29sbGVjdG9yIiwiQWNtZUN5YmVyU0RLIiwiY29sbGVjdG9ycyIsImNvbnN0cnVjdG9yIiwiZXZlbnRzTWFuYWdlciIsIkV2ZW50c01hbmFnZXIiLCJnZXRJbnN0YW5jZSIsImluaXRpYWxpemVDb2xsZWN0b3JzIiwiY29uZmlnIiwiZ2V0Q29uZmlnIiwicmVndWxhckNvbGxlY3RvcnMiLCJTY3JlZW5XaWR0aENvbGxlY3RvciIsIlNjcmVlbkhlaWdodENvbGxlY3RvciIsIkxhbmd1YWdlQ29sbGVjdG9yIiwiVXNlckFnZW50Q29sbGVjdG9yIiwiVGltZXpvbmVDb2xsZWN0b3IiLCJDb29raWVzRW5hYmxlZENvbGxlY3RvciIsIkphdmFTY3JpcHRFbmFibGVkQ29sbGVjdG9yIiwiT25saW5lU3RhdHVzQ29sbGVjdG9yIiwiUmVmZXJyZXJDb2xsZWN0b3IiLCJMb2NhbFN0b3JhZ2VBdmFpbGFibGVDb2xsZWN0b3IiLCJCcm93c2VySW5mb0NvbGxlY3RvciIsIlBsYXRmb3JtQ29sbGVjdG9yIiwiSGFyZHdhcmVDb25jdXJyZW5jeUNvbGxlY3RvciIsIlBsdWdpbnNDb2xsZWN0b3IiLCJEb05vdFRyYWNrQ29sbGVjdG9yIiwiQ29sb3JEZXB0aENvbGxlY3RvciIsIlRvdWNoU3VwcG9ydENvbGxlY3RvciIsIkN1cnJlbnRVcmxDb2xsZWN0b3IiLCJIaXN0b3J5TGVuZ3RoQ29sbGVjdG9yIiwiV2luZG93U2l6ZUNvbGxlY3RvciIsIlNjcmVlbk9yaWVudGF0aW9uQ29sbGVjdG9yIiwiVmlkZW9TdXBwb3J0Q29sbGVjdG9yIiwiY29udGludW91c0NvbGxlY3RvcnMiLCJNb3VzZU1vdmVDb2xsZWN0b3IiLCJLZXlib2FyZFByZXNzQ29sbGVjdG9yIiwiQ2xpY2tzQ29sbGVjdG9yIiwiU2Nyb2xsQ29sbGVjdG9yIiwiUmVzaXplQ29sbGVjdG9yIiwiVmlzaWJpbGl0eUNoYW5nZUNvbGxlY3RvciIsIm1hcCIsIkNvbGxlY3RvckNsYXNzIiwiQ09MTEVDVE9SU19JTlRFUlZBTCIsImVycm9yIiwiY29uc29sZSIsIm5hbWUiLCJERUZBVUxUX0JVRkZFUl9DT05USU5VT1VTX0NPTExFQ1RPUlMiLCJmaWx0ZXIiLCJjb2xsZWN0b3IiLCJzdGFydCIsIlNES19FTkFCTEVEIiwiZm9yRWFjaCIsInN0YXJ0Q29sbGVjdCIsImdldEtleSIsInNjaGVkdWxlRGF0YVVwZGF0ZSIsInNldEludGVydmFsIiwiZGF0YSIsImdldERhdGEiLCJ1cGRhdGVEYXRhIiwiZXhwb3J0cyIsImRvY3VtZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsInNkayIsImRpc3BhdGNoRXZlbnQiLCJDdXN0b21FdmVudCJdLCJzb3VyY2VzIjpbIi4uL3NyYy9tYWluLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEV2ZW50c01hbmFnZXIgfSBmcm9tICcuL21hbmFnZXJzL0V2ZW50c01hbmFnZXInO1xuaW1wb3J0IHsgQ29sbGVjdG9yIH0gZnJvbSAnLi9pbnRlcmZhY2VzL0NvbGxlY3Rvcic7XG5pbXBvcnQgeyBDb250aW51b3VzQ29sbGVjdG9yIH0gZnJvbSAnLi9pbnRlcmZhY2VzL0NvbnRpbnVvdXNDb2xsZWN0b3InO1xuaW1wb3J0IHsgU2NyZWVuV2lkdGhDb2xsZWN0b3IgfSBmcm9tICcuL2NvbGxlY3RvcnMvcmVndWxhci9TY3JlZW5XaWR0aENvbGxlY3Rvcic7XG5pbXBvcnQgeyBTY3JlZW5IZWlnaHRDb2xsZWN0b3IgfSBmcm9tICcuL2NvbGxlY3RvcnMvcmVndWxhci9TY3JlZW5IZWlnaHRDb2xsZWN0b3InO1xuaW1wb3J0IHsgTGFuZ3VhZ2VDb2xsZWN0b3IgfSBmcm9tICcuL2NvbGxlY3RvcnMvcmVndWxhci9MYW5ndWFnZUNvbGxlY3Rvcic7XG5pbXBvcnQgeyBVc2VyQWdlbnRDb2xsZWN0b3IgfSBmcm9tICcuL2NvbGxlY3RvcnMvcmVndWxhci9Vc2VyQWdlbnRDb2xsZWN0b3InO1xuaW1wb3J0IHsgVGltZXpvbmVDb2xsZWN0b3IgfSBmcm9tICcuL2NvbGxlY3RvcnMvcmVndWxhci9UaW1lem9uZUNvbGxlY3Rvcic7XG5pbXBvcnQgeyBDb29raWVzRW5hYmxlZENvbGxlY3RvciB9IGZyb20gJy4vY29sbGVjdG9ycy9yZWd1bGFyL0Nvb2tpZXNFbmFibGVkQ29sbGVjdG9yJztcbmltcG9ydCB7IEphdmFTY3JpcHRFbmFibGVkQ29sbGVjdG9yIH0gZnJvbSAnLi9jb2xsZWN0b3JzL3JlZ3VsYXIvSmF2YVNjcmlwdEVuYWJsZWRDb2xsZWN0b3InO1xuaW1wb3J0IHsgT25saW5lU3RhdHVzQ29sbGVjdG9yIH0gZnJvbSAnLi9jb2xsZWN0b3JzL3JlZ3VsYXIvT25saW5lU3RhdHVzQ29sbGVjdG9yJztcbmltcG9ydCB7IFJlZmVycmVyQ29sbGVjdG9yIH0gZnJvbSAnLi9jb2xsZWN0b3JzL3JlZ3VsYXIvUmVmZXJyZXJDb2xsZWN0b3InO1xuaW1wb3J0IHsgTG9jYWxTdG9yYWdlQXZhaWxhYmxlQ29sbGVjdG9yIH0gZnJvbSAnLi9jb2xsZWN0b3JzL3JlZ3VsYXIvTG9jYWxTdG9yYWdlQXZhaWxhYmxlQ29sbGVjdG9yJztcbmltcG9ydCB7IEJyb3dzZXJJbmZvQ29sbGVjdG9yIH0gZnJvbSAnLi9jb2xsZWN0b3JzL3JlZ3VsYXIvQnJvd3NlckluZm9Db2xsZWN0b3InO1xuaW1wb3J0IHsgUGxhdGZvcm1Db2xsZWN0b3IgfSBmcm9tICcuL2NvbGxlY3RvcnMvcmVndWxhci9QbGF0Zm9ybUNvbGxlY3Rvcic7XG5pbXBvcnQgeyBIYXJkd2FyZUNvbmN1cnJlbmN5Q29sbGVjdG9yIH0gZnJvbSAnLi9jb2xsZWN0b3JzL3JlZ3VsYXIvSGFyZHdhcmVDb25jdXJyZW5jeUNvbGxlY3Rvcic7XG5pbXBvcnQgeyBQbHVnaW5zQ29sbGVjdG9yIH0gZnJvbSAnLi9jb2xsZWN0b3JzL3JlZ3VsYXIvUGx1Z2luc0NvbGxlY3Rvcic7XG5pbXBvcnQgeyBEb05vdFRyYWNrQ29sbGVjdG9yIH0gZnJvbSAnLi9jb2xsZWN0b3JzL3JlZ3VsYXIvRG9Ob3RUcmFja0NvbGxlY3Rvcic7XG5pbXBvcnQgeyBDb2xvckRlcHRoQ29sbGVjdG9yIH0gZnJvbSAnLi9jb2xsZWN0b3JzL3JlZ3VsYXIvQ29sb3JEZXB0aENvbGxlY3Rvcic7XG5pbXBvcnQgeyBUb3VjaFN1cHBvcnRDb2xsZWN0b3IgfSBmcm9tICcuL2NvbGxlY3RvcnMvcmVndWxhci9Ub3VjaFN1cHBvcnRDb2xsZWN0b3InO1xuaW1wb3J0IHsgQ3VycmVudFVybENvbGxlY3RvciB9IGZyb20gJy4vY29sbGVjdG9ycy9yZWd1bGFyL0N1cnJlbnRVcmxDb2xsZWN0b3InO1xuaW1wb3J0IHsgSGlzdG9yeUxlbmd0aENvbGxlY3RvciB9IGZyb20gJy4vY29sbGVjdG9ycy9yZWd1bGFyL0hpc3RvcnlMZW5ndGhDb2xsZWN0b3InO1xuaW1wb3J0IHsgV2luZG93U2l6ZUNvbGxlY3RvciB9IGZyb20gJy4vY29sbGVjdG9ycy9yZWd1bGFyL1dpbmRvd1NpemVDb2xsZWN0b3InO1xuaW1wb3J0IHsgU2NyZWVuT3JpZW50YXRpb25Db2xsZWN0b3IgfSBmcm9tICcuL2NvbGxlY3RvcnMvcmVndWxhci9TY3JlZW5PcmllbnRhdGlvbkNvbGxlY3Rvcic7XG5pbXBvcnQgeyBWaWRlb1N1cHBvcnRDb2xsZWN0b3IgfSBmcm9tICcuL2NvbGxlY3RvcnMvcmVndWxhci9WaWRlb1N1cHBvcnRDb2xsZWN0b3InO1xuaW1wb3J0IHsgTW91c2VNb3ZlQ29sbGVjdG9yIH0gZnJvbSAnLi9jb2xsZWN0b3JzL2NvbnRpbnVvdXMvTW91c2VNb3ZlQ29sbGVjdG9yJztcbmltcG9ydCB7IEtleWJvYXJkUHJlc3NDb2xsZWN0b3IgfSBmcm9tICcuL2NvbGxlY3RvcnMvY29udGludW91cy9LZXlib2FyZFByZXNzQ29sbGVjdG9yJztcbmltcG9ydCB7IENsaWNrc0NvbGxlY3RvciB9IGZyb20gJy4vY29sbGVjdG9ycy9jb250aW51b3VzL0NsaWNrc0NvbGxlY3Rvcic7XG5pbXBvcnQgeyBTY3JvbGxDb2xsZWN0b3IgfSBmcm9tICcuL2NvbGxlY3RvcnMvY29udGludW91cy9TY3JvbGxDb2xsZWN0b3InO1xuaW1wb3J0IHsgUmVzaXplQ29sbGVjdG9yIH0gZnJvbSAnLi9jb2xsZWN0b3JzL2NvbnRpbnVvdXMvUmVzaXplQ29sbGVjdG9yJztcbmltcG9ydCB7IFZpc2liaWxpdHlDaGFuZ2VDb2xsZWN0b3IgfSBmcm9tICcuL2NvbGxlY3RvcnMvY29udGludW91cy9WaXNpYmlsaXR5Q2hhbmdlQ29sbGVjdG9yJztcblxudHlwZSBSZWd1bGFyQ29sbGVjdG9yQ29uc3RydWN0b3IgPSBuZXcgKGludGVydmFsOiBudW1iZXIpID0+IENvbGxlY3Rvcjxhbnk+O1xudHlwZSBDb250aW51b3VzQ29sbGVjdG9yQ29uc3RydWN0b3IgPSBuZXcgKGludGVydmFsOiBudW1iZXIsIGJ1ZmZlclNpemU6IG51bWJlcikgPT4gQ29udGludW91c0NvbGxlY3Rvcjxhbnk+O1xudHlwZSBBbnlDb2xsZWN0b3IgPSBDb2xsZWN0b3I8YW55PiB8IENvbnRpbnVvdXNDb2xsZWN0b3I8YW55PjtcblxuZXhwb3J0IGNsYXNzIEFjbWVDeWJlclNESyB7XG4gIHByaXZhdGUgY29sbGVjdG9yczogQW55Q29sbGVjdG9yW10gPSBbXTtcbiAgcHJpdmF0ZSBldmVudHNNYW5hZ2VyOiBFdmVudHNNYW5hZ2VyO1xuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuZXZlbnRzTWFuYWdlciA9IEV2ZW50c01hbmFnZXIuZ2V0SW5zdGFuY2UoKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgaW5pdGlhbGl6ZUNvbGxlY3RvcnMoKSB7XG4gICAgY29uc3QgY29uZmlnID0gYXdhaXQgdGhpcy5ldmVudHNNYW5hZ2VyLmdldENvbmZpZygpO1xuICAgIGNvbnN0IHJlZ3VsYXJDb2xsZWN0b3JzOiBSZWd1bGFyQ29sbGVjdG9yQ29uc3RydWN0b3JbXSA9IFtcbiAgICAgIFNjcmVlbldpZHRoQ29sbGVjdG9yLCBTY3JlZW5IZWlnaHRDb2xsZWN0b3IsIExhbmd1YWdlQ29sbGVjdG9yLFxuICAgICAgVXNlckFnZW50Q29sbGVjdG9yLCBUaW1lem9uZUNvbGxlY3RvciwgQ29va2llc0VuYWJsZWRDb2xsZWN0b3IsXG4gICAgICBKYXZhU2NyaXB0RW5hYmxlZENvbGxlY3RvciwgT25saW5lU3RhdHVzQ29sbGVjdG9yLCBSZWZlcnJlckNvbGxlY3RvcixcbiAgICAgIExvY2FsU3RvcmFnZUF2YWlsYWJsZUNvbGxlY3RvciwgQnJvd3NlckluZm9Db2xsZWN0b3IsIFBsYXRmb3JtQ29sbGVjdG9yLFxuICAgICAgSGFyZHdhcmVDb25jdXJyZW5jeUNvbGxlY3RvciwgUGx1Z2luc0NvbGxlY3RvciwgRG9Ob3RUcmFja0NvbGxlY3RvcixcbiAgICAgIENvbG9yRGVwdGhDb2xsZWN0b3IsIFRvdWNoU3VwcG9ydENvbGxlY3RvciwgQ3VycmVudFVybENvbGxlY3RvcixcbiAgICAgIEhpc3RvcnlMZW5ndGhDb2xsZWN0b3IsIFdpbmRvd1NpemVDb2xsZWN0b3IsIFNjcmVlbk9yaWVudGF0aW9uQ29sbGVjdG9yLFxuICAgICAgVmlkZW9TdXBwb3J0Q29sbGVjdG9yXG4gICAgXTtcblxuICAgIGNvbnN0IGNvbnRpbnVvdXNDb2xsZWN0b3JzOiBDb250aW51b3VzQ29sbGVjdG9yQ29uc3RydWN0b3JbXSA9IFtcbiAgICAgIE1vdXNlTW92ZUNvbGxlY3RvciwgS2V5Ym9hcmRQcmVzc0NvbGxlY3RvciwgQ2xpY2tzQ29sbGVjdG9yLFxuICAgICAgU2Nyb2xsQ29sbGVjdG9yLCBSZXNpemVDb2xsZWN0b3IsIFZpc2liaWxpdHlDaGFuZ2VDb2xsZWN0b3JcbiAgICBdO1xuXG4gICAgdGhpcy5jb2xsZWN0b3JzID0gW1xuICAgICAgLi4ucmVndWxhckNvbGxlY3RvcnMubWFwKENvbGxlY3RvckNsYXNzID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICByZXR1cm4gbmV3IENvbGxlY3RvckNsYXNzKGNvbmZpZy5DT0xMRUNUT1JTX0lOVEVSVkFMKTtcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGBGYWlsZWQgdG8gaW5pdGlhbGl6ZSAke0NvbGxlY3RvckNsYXNzLm5hbWV9OmAsIGVycm9yKTtcbiAgICAgICAgICByZXR1cm4gbnVsbDtcbiAgICAgICAgfVxuICAgICAgfSksXG4gICAgICAuLi5jb250aW51b3VzQ29sbGVjdG9ycy5tYXAoQ29sbGVjdG9yQ2xhc3MgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgIHJldHVybiBuZXcgQ29sbGVjdG9yQ2xhc3MoY29uZmlnLkNPTExFQ1RPUlNfSU5URVJWQUwsIGNvbmZpZy5ERUZBVUxUX0JVRkZFUl9DT05USU5VT1VTX0NPTExFQ1RPUlMpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBpbml0aWFsaXplICR7Q29sbGVjdG9yQ2xhc3MubmFtZX06YCwgZXJyb3IpO1xuICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICB9KVxuICAgIF0uZmlsdGVyKChjb2xsZWN0b3IpOiBjb2xsZWN0b3IgaXMgQW55Q29sbGVjdG9yID0+IGNvbGxlY3RvciAhPT0gbnVsbCk7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgc3RhcnQoKSB7XG4gICAgY29uc3QgY29uZmlnID0gYXdhaXQgdGhpcy5ldmVudHNNYW5hZ2VyLmdldENvbmZpZygpO1xuICAgIGlmIChjb25maWcuU0RLX0VOQUJMRUQpIHtcbiAgICAgIGF3YWl0IHRoaXMuaW5pdGlhbGl6ZUNvbGxlY3RvcnMoKTtcbiAgICAgIHRoaXMuY29sbGVjdG9ycy5mb3JFYWNoKGNvbGxlY3RvciA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29sbGVjdG9yLnN0YXJ0Q29sbGVjdCgpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEZhaWxlZCB0byBzdGFydCAke2NvbGxlY3Rvci5nZXRLZXkoKX0gY29sbGVjdG9yOmAsIGVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICB0aGlzLnNjaGVkdWxlRGF0YVVwZGF0ZSgpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgc2NoZWR1bGVEYXRhVXBkYXRlKCkge1xuICAgIGNvbnN0IGNvbmZpZyA9IGF3YWl0IHRoaXMuZXZlbnRzTWFuYWdlci5nZXRDb25maWcoKTtcbiAgICBzZXRJbnRlcnZhbChhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBkYXRhOiB7IFtrZXk6IHN0cmluZ106IGFueSB9ID0ge307XG4gICAgICBmb3IgKGNvbnN0IGNvbGxlY3RvciBvZiB0aGlzLmNvbGxlY3RvcnMpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBkYXRhW2NvbGxlY3Rvci5nZXRLZXkoKV0gPSBjb2xsZWN0b3IuZ2V0RGF0YSgpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoYEVycm9yIGNvbGxlY3RpbmcgZGF0YSBmcm9tICR7Y29sbGVjdG9yLmdldEtleSgpfTpgLCBlcnJvcik7XG4gICAgICAgICAgZGF0YVtjb2xsZWN0b3IuZ2V0S2V5KCldID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgdGhpcy5ldmVudHNNYW5hZ2VyLnVwZGF0ZURhdGEoZGF0YSk7XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gdXBkYXRlIGRhdGE6JywgZXJyb3IpO1xuICAgICAgfVxuICAgIH0sIGNvbmZpZy5DT0xMRUNUT1JTX0lOVEVSVkFMKTtcbiAgfVxufVxuXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdhY21lLXNkay1sb2FkZWQnLCBhc3luYyAoKSA9PiB7XG4gIGNvbnN0IHNkayA9IG5ldyBBY21lQ3liZXJTREsoKTtcbiAgYXdhaXQgc2RrLnN0YXJ0KCk7XG59KTtcblxuZG9jdW1lbnQuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoJ2FjbWUtc2RrLWxvYWRlZCcpKTsiXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBLElBQUFBLGNBQUEsR0FBQUMsT0FBQTtBQUdBLElBQUFDLHFCQUFBLEdBQUFELE9BQUE7QUFDQSxJQUFBRSxzQkFBQSxHQUFBRixPQUFBO0FBQ0EsSUFBQUcsa0JBQUEsR0FBQUgsT0FBQTtBQUNBLElBQUFJLG1CQUFBLEdBQUFKLE9BQUE7QUFDQSxJQUFBSyxrQkFBQSxHQUFBTCxPQUFBO0FBQ0EsSUFBQU0s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